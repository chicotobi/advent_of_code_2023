rm(list=ls())

df <- tribble(
  ~x, ~y,0 , 1 ,
  1 , 4 ,
  2 , 9 ,
  3 , 15 ,
  4 , 23 ,
  5 , 33 ,
  6 , 47 ,
  7 , 57 ,
  8 , 77 ,
  9 , 86 ,
  10 , 114 ,
  11 , 127 ,
  12 , 161 ,
  13 , 177 ,
  14 , 215 ,
  15 , 233 ,
  16 , 269 ,
  17 , 293 ,
  18 , 332 ,
  19 , 362 ,
  20 , 403 ,
  21 , 437 ,
  22 , 482 ,
  23 , 522 ,
  24 , 570 ,
  25 , 613 ,
  26 , 665 ,
  27 , 708 ,
  28 , 759 ,
  29 , 810 ,
  30 , 866 ,
  31 , 926 ,
  32 , 984 ,
  33 , 1048 ,
  34 , 1111 ,
  35 , 1176 ,
  36 , 1241 ,
  37 , 1309 ,
  38 , 1372 ,
  39 , 1442 ,
  40 , 1521 ,
  41 , 1591 ,
  42 , 1675 ,
  43 , 1748 ,
  44 , 1836 ,
  45 , 1904 ,
  46 , 1992 ,
  47 , 2067 ,
  48 , 2166 ,
  49 , 2239 ,
  50 , 2340 ,
  51 , 2414 ,
  52 , 2527 ,
  53 , 2601 ,
  54 , 2720 ,
  55 , 2799 ,
  56 , 2920 ,
  57 , 2999 ,
  58 , 3139 ,
  59 , 3205 ,
  60 , 3348 ,
  61 , 3423 ,
  62 , 3596 ,
  63 , 3681 ,
  64 , 3858 ,
  65 , 3943 ,
  66 , 4122 ,
  67 , 4211 ,
  68 , 4394 ,
  69 , 4461 ,
  70 , 4638 ,
  71 , 4723 ,
  72 , 4896 ,
  73 , 4988 ,
  74 , 5174 ,
  75 , 5270 ,
  76 , 5444 ,
  77 , 5552 ,
  78 , 5723 ,
  79 , 5837 ,
  80 , 6019 ,
  81 , 6134 ,
  82 , 6316 ,
  83 , 6430 ,
  84 , 6624 ,
  85 , 6740 ,
  86 , 6926 ,
  87 , 7053 ,
  88 , 7251 ,
  89 , 7382 ,
  90 , 7574 ,
  91 , 7715 ,
  92 , 7905 ,
  93 , 8049 ,
  94 , 8242 ,
  95 , 8383 ,
  96 , 8590 ,
  97 , 8733 ,
  98 , 8934 ,
  99 , 9080 ,
  100 , 9288 ,
  101 , 9442 ,
  102 , 9649 ,
  103 , 9811 ,
  104 , 10018 ,
  105 , 10199 ,
  106 , 10405 ,
  107 , 10587 ,
  108 , 10798 ,
  109 , 10973 ,
  110 , 11188 ,
  111 , 11365 ,
  112 , 11599 ,
  113 , 11778 ,
  114 , 11995 ,
  115 , 12182 ,
  116 , 12413 ,
  117 , 12606 ,
  118 , 12830 ,
  119 , 13030 ,
  120 , 13269 ,
  121 , 13481 ,
  122 , 13704 ,
  123 , 13927 ,
  124 , 14157 ,
  125 , 14380 ,
  126 , 14628 ,
  127 , 14849 ,
  128 , 15082 ,
  129 , 15304 ,
  130 , 15537 ,
  131 , 15779 ,
  132 , 16013 ,
  133 , 16254 ,
  134 , 16480 ,
  135 , 16746 ,
  136 , 16988 ,
  137 , 17255 ,
  138 , 17499 ,
  139 , 17761 ,
  140 , 17989 ,
  141 , 18278 ,
  142 , 18509 ,
  143 , 18801 ,
  144 , 19025 ,
  145 , 19329 ,
  146 , 19554 ,
  147 , 19847 ,
  148 , 20073 ,
  149 , 20385 ,
  150 , 20613 ,
  151 , 20916 ,
  152 , 21155 ,
  153 , 21453 ,
  154 , 21718 ,
  155 , 22023 ,
  156 , 22291 ,
  157 , 22597 ,
  158 , 22851 ,
  159 , 23156 ,
  160 , 23414 ,
  161 , 23731 ,
  162 , 24004 ,
  163 , 24319 ,
  164 , 24592 ,
  165 , 24919 ,
  166 , 25193 ,
  167 , 25519 ,
  168 , 25801 ,
  169 , 26120 ,
  170 , 26396 ,
  171 , 26750 ,
  172 , 27022 ,
  173 , 27386 ,
  174 , 27661 ,
  175 , 28027 ,
  176 , 28275 ,
  177 , 28642 ,
  178 , 28908 ,
  179 , 29291 ,
  180 , 29550 ,
  181 , 29931 ,
  182 , 30192 ,
  183 , 30593 ,
  184 , 30853 ,
  185 , 31261 ,
  186 , 31515 ,
  187 , 31939 ,
  188 , 32195 ,
  189 , 32646 ,
  190 , 32868 ,
  191 , 33330 ,
  192 , 33550 ,
  193 , 34074 ,
  194 , 34337 ,
  195 , 34871 ,
  196 , 35126 ,
  197 , 35659 ,
  198 , 35918 ,
  199 , 36455 ,
  200 , 36666 ,
  201 , 37163 ,
  202 , 37397 ,
  203 , 37882 ,
  204 , 38141 ,
  205 , 38636 ,
  206 , 38905 ,
  207 , 39377 ,
  208 , 39666 ,
  209 , 40124 ,
  210 , 40422 ,
  211 , 40892 ,
  212 , 41189 ,
  213 , 41651 ,
  214 , 41952 ,
  215 , 42438 ,
  216 , 42739 ,
  217 , 43197 ,
  218 , 43524 ,
  219 , 44007 ,
  220 , 44336 ,
  221 , 44802 ,
  222 , 45154 ,
  223 , 45598 ,
  224 , 45952 ,
  225 , 46402 ,
  226 , 46752 ,
  227 , 47227 ,
  228 , 47579 ,
  229 , 48037 ,
  230 , 48389 ,
  231 , 48859 ,
  232 , 49218 ,
  233 , 49685 ,
  234 , 50054 ,
  235 , 50517 ,
  236 , 50923 ,
  237 , 51384 ,
  238 , 51789 ,
  239 , 52255 ,
  240 , 52640 ,
  241 , 53110 ,
  242 , 53496 ,
  243 , 54000 ,
  244 , 54384 ,
  245 , 54853 ,
  246 , 55246 ,
  247 , 55744 ,
  248 , 56149 ,
  249 , 56630 ,
  250 , 57043 ,
  251 , 57549 ,
  252 , 57982 ,
  253 , 58448 ,
  254 , 58904 ,
  255 , 59379 ,
  256 , 59833 ,
  257 , 60338 ,
  258 , 60787 ,
  259 , 61258 ,
  260 , 61705 ,
  261 , 62172 ,
  262 , 62655 ,
  263 , 63120 ,
  264 , 63597 ,
  265 , 64043 ,
  266 , 64567 ,
  267 , 65041 ,
  268 , 65561 ,
  269 , 66039 ,
  270 , 66543 ,
  271 , 66990 ,
  272 , 67540 ,
  273 , 67989 ,
  274 , 68539 ,
  275 , 68971 ,
  276 , 69541 ,
  277 , 69973 ,
  278 , 70523 ,
  279 , 70951 ,
  280 , 71536 ,
  281 , 71962 ,
  282 , 72527 ,
  283 , 72971 ,
  284 , 73522 ,
  285 , 74012 ,
  286 , 74574 ,
  287 , 75067 ,
  288 , 75627 ,
  289 , 76092 ,
  290 , 76651 ,
  291 , 77116 ,
  292 , 77694 ,
  293 , 78180 ,
  294 , 78752 ,
  295 , 79234 ,
  296 , 79825 ,
  297 , 80308 ,
  298 , 80895 ,
  299 , 81391 ,
  300 , 81966 ,
  301 , 82448 ,
  302 , 83077 ,
  303 , 83551 ,
  304 , 84195 ,
  305 , 84672 ,
  306 , 85316 ,
  307 , 85744 ,
  308 , 86390 ,
  309 , 86847 ,
  310 , 87514 ,
  311 , 87959 ,
  312 , 88620 ,
  313 , 89068 ,
  314 , 89757 ,
  315 , 90203 ,
  316 , 90900 ,
  317 , 91329 ,
  318 , 92056 ,
  319 , 92489 ,
  320 , 93251 ,
  321 , 93629 ,
  322 , 94410 ,
  323 , 94775 ,
  324 , 95650 ,
  325 , 96091 ,
  326 , 96982 ,
  327 , 97407 ,
  328 , 98294 ,
  329 , 98723 ,
  330 , 99614 ,
  331 , 99969 ,
  332 , 100786 ,
  333 , 101169 ,
  334 , 101966 ,
  335 , 102392 ,
  336 , 103196 ,
  337 , 103638 ,
  338 , 104408 ,
  339 , 104878 ,
  340 , 105623 ,
  341 , 106105 ,
  342 , 106863 ,
  343 , 107342 ,
  344 , 108084 ,
  345 , 108572 ,
  346 , 109350 ,
  347 , 109836 ,
  348 , 110566 ,
  349 , 111093 ,
  350 , 111861 ,
  351 , 112388 ,
  352 , 113128 ,
  353 , 113691 ,
  354 , 114389 ,
  355 , 114953 ,
  356 , 115660 ,
  357 , 116219 ,
  358 , 116962 ,
  359 , 117523 ,
  360 , 118238 ,
  361 , 118796 ,
  362 , 119528 ,
  363 , 120092 ,
  364 , 120819 ,
  365 , 121395 ,
  366 , 122114 ,
  367 , 122745 ,
  368 , 123461 ,
  369 , 124089 ,
  370 , 124810 ,
  371 , 125405 ,
  372 , 126130 ,
  373 , 126725 ,
  374 , 127499 ,
  375 , 128088 ,
  376 , 128809 ,
  377 , 129408 ,
  378 , 130173 ,
  379 , 130790 ,
  380 , 131528 ,
  381 , 132154 ,
  382 , 132927 ,
  383 , 133581 ,
  384 , 134290 ,
  385 , 134979 ,
  386 , 135699 ,
  387 , 136384 ,
  388 , 137146 ,
  389 , 137823 ,
  390 , 138532 ,
  391 , 139204 ,
  392 , 139905 ,
  393 , 140629 ,
  394 , 141325 ,
  395 , 142038 ,
  396 , 142704 ,
  397 , 143486 ,
  398 , 144192 ,
  399 , 144965 ,
  400 , 145677 ,
  401 , 146423 ,
  402 , 147089 ,
  403 , 147900 ,
  404 , 148567 ,
  405 , 149375 ,
  406 , 150015 ,
  407 , 150851 ,
  408 , 151490 ,
  409 , 152297 ,
  410 , 152927 ,
  411 , 153785 ,
  412 , 154409 ,
  413 , 155236 ,
  414 , 155885 ,
  415 , 156689 ,
  416 , 157404 ,
  417 , 158223 ,
  418 , 158941 ,
  419 , 159755 ,
  420 , 160431 ,
  421 , 161244 ,
  422 , 161916 ,
  423 , 162755 ,
  424 , 163454 ,
  425 , 164283 ,
  426 , 164974 ,
  427 , 165829 ,
  428 , 166521 ,
  429 , 167369 ,
  430 , 168079 ,
  431 , 168910 ,
  432 , 169598 ,
  433 , 170502 ,
  434 , 171178 ,
  435 , 172102 ,
  436 , 172781 ,
  437 , 173703 ,
  438 , 174311 ,
  439 , 175236 ,
  440 , 175884 ,
  441 , 176835 ,
  442 , 177466 ,
  443 , 178407 ,
  444 , 179042 ,
  445 , 180019 ,
  446 , 180651 ,
  447 , 181637 ,
  448 , 182241 ,
  449 , 183271 ,
  450 , 183881 ,
  451 , 184954 ,
  452 , 185488 ,
  453 , 186588 ,
  454 , 187098 ,
  455 , 188324 ,
  456 , 188943 ,
  457 , 190191 ,
  458 , 190786 ,
  459 , 192027 ,
  460 , 192626 ,
  461 , 193871 ,
  462 , 194370 ,
  463 , 195507 ,
  464 , 196039 ,
  465 , 197148 ,
  466 , 197741 ,
  467 , 198854 ,
  468 , 199469 ,
  469 , 200537 ,
  470 , 201188 ,
  471 , 202220 ,
  472 , 202886 ,
  473 , 203932 ,
  474 , 204593 ,
  475 , 205615 ,
  476 , 206290 ,
  477 , 207360 ,
  478 , 208031 ,
  479 , 209033 ,
  480 , 209760 ,
  481 , 210813 ,
  482 , 211538 ,
  483 , 212552 ,
  484 , 213326 ,
  485 , 214278 ,
  486 , 215052 ,
  487 , 216016 ,
  488 , 216784 ,
  489 , 217795 ,
  490 , 218565 ,
  491 , 219537 ,
  492 , 220301 ,
  493 , 221295 ,
  494 , 222064 ,
  495 , 223051 ,
  496 , 223834 ,
  497 , 224809 ,
  498 , 225665 ,
  499 , 226636 ,
  500 , 227487 ,
  501 , 228463 ,
  502 , 229268 ,
  503 , 230248 ,
  504 , 231052 ,
  505 , 232096 ,
  506 , 232890 ,
  507 , 233863 ,
  508 , 234668 ,
  509 , 235700 ,
  510 , 236529 ,
  511 , 237524 ,
  512 , 238363 ,
  513 , 239403 ,
  514 , 240278 ,
  515 , 241230 ,
  516 , 242152 ,
  517 , 243117 ,
  518 , 244033 ,
  519 , 245052 ,
  520 , 245957 ,
  521 , 246904 ,
  522 , 247801 ,
  523 , 248736 ,
  524 , 249701 ,
  525 , 250628 ,
  526 , 251577 ,
  527 , 252463 ,
  528 , 253503 ,
  529 , 254441 ,
  530 , 255467 ,
  531 , 256413 ,
  532 , 257401 ,
  533 , 258286 ,
  534 , 259358 ,
  535 , 260243 ,
  536 , 261309 ,
  537 , 262157 ,
  538 , 263259 ,
  539 , 264105 ,
  540 , 265169 ,
  541 , 266001 ,
  542 , 267132 ,
  543 , 267954 ,
  544 , 269043 ,
  545 , 269897 ,
  546 , 270954 ,
  547 , 271894 ,
  548 , 272970 ,
  549 , 273913 ,
  550 , 274981 ,
  551 , 275868 ,
  552 , 276935 ,
  553 , 277814 ,
  554 , 278914 ,
  555 , 279826 ,
  556 , 280912 ,
  557 , 281812 ,
  558 , 282931 ,
  559 , 283832 ,
  560 , 284941 ,
  561 , 285865 ,
  562 , 286952 ,
  563 , 287846 ,
  564 , 289025 ,
  565 , 289903 ,
  566 , 291107 ,
  567 , 291988 ,
  568 , 293188 ,
  569 , 293976 ,
  570 , 295180 ,
  571 , 296019 ,
  572 , 297254 ,
  573 , 298071 ,
  574 , 299292 ,
  575 , 300114 ,
  576 , 301379 ,
  577 , 302197 ,
  578 , 303472 ,
  579 , 304251 ,
  580 , 305584 ,
  581 , 306371 ,
  582 , 307755 ,
  583 , 308445 ,
  584 , 309864 ,
  585 , 310519 ,
  586 , 312096 ,
  587 , 312893 ,
  588 , 314498 ,
  589 , 315263 ,
  590 , 316858 ,
  591 , 317627 ,
  592 , 319226 ,
  593 , 319869 ,
  594 , 321326 ,
  595 , 322007 ,
  596 , 323428 ,
  597 , 324188 ,
  598 , 325610 ,
  599 , 326398 ,
  600 , 327764 ,
  601 , 328596 ,
  602 , 329915 ,
  603 , 330765 ,
  604 , 332099 ,
  605 , 332942 ,
  606 , 334244 ,
  607 , 335106 ,
  608 , 336468 ,
  609 , 337324 ,
  610 , 338598 ,
  611 , 339525 ,
  612 , 340863 ,
  613 , 341786 ,
  614 , 343074 ,
  615 , 344059 ,
  616 , 345265 ,
  617 , 346249 ,
  618 , 347470 ,
  619 , 348447 ,
  620 , 349726 ,
  621 , 350705 ,
  622 , 351934 ,
  623 , 352904 ,
  624 , 354160 ,
  625 , 355134 ,
  626 , 356381 ,
  627 , 357371 ,
  628 , 358602 ,
  629 , 359683 ,
  630 , 360909 ,
  631 , 361983 ,
  632 , 363214 ,
  633 , 364229 ,
  634 , 365464 ,
  635 , 366477 ,
  636 , 367791 ,
  637 , 368790 ,
  638 , 370015 ,
  639 , 371026 ,
  640 , 372325 ,
  641 , 373366 ,
  642 , 374618 ,
  643 , 375670 ,
  644 , 376977 ,
  645 , 378073 ,
  646 , 379268 ,
  647 , 380423 ,
  648 , 381633 ,
  649 , 382780 ,
  650 , 384056 ,
  651 , 385189 ,
  652 , 386374 ,
  653 , 387496 ,
  654 , 388665 ,
  655 , 389871 ,
  656 , 391029 ,
  657 , 392214 ,
  658 , 393320 ,
  659 , 394618 ,
  660 , 395788 ,
  661 , 397067 ,
  662 , 398247 ,
  663 , 399477 ,
  664 , 400581 ,
  665 , 401914
) %>% mutate(ydiff=y-lag(y))

# Get period length
df %>% ggplot(aes(x,ydiff)) + geom_point()
period_length <- 131

steps <- 26501365
rem <- steps%%period_length
df3 <- df %>% filter(x%%period_length==rem) %>% tail(3)

ff <- function(a,b,c,d,e,f,g) {
  x = (a*(f - d) + b*(c - e) - c*f + d*e)/((a - c)*(a - e)*(c - e))
  y = (a^2*(d - f) + b*(e^2 - c^2) + c^2*f - d*e^2)/((a - c)*(a - e)*(c - e))
  z = (a*(a*c*f - a*d*e + c^2*(-f) + d*e^2) + b*c*e*(c - e))/((a - c)*(a - e)*(c - e))
  x * g *g + y * g + z
}

a <- df3$x[1]
b <- df3$y[1]
c <- df3$x[2]
d <- df3$y[2]
e <- df3$x[3]
f <- df3$y[3]

ff(a,b,c,d,e,f,steps) %>% message()
